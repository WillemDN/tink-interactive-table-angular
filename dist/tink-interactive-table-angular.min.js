/*! tink-interactive-table-angular v1.0.0 */
"use strict";!function(module){try{module=angular.module("tink.interactivetable")}catch(e){module=angular.module("tink.interactivetable",["ngLodash","tink.popover"])}module.directive("tinkInteractiveTable",["lodash","$compile","$rootScope",function(_,$compile,$rootScope){return{restrict:"E",require:"ngModel",templateUrl:"templates/tinkInteractiveTable.html",scope:{ngModel:"=",headers:"=",actions:"=?",itemsPerPage:"=?",allowColumnReorder:"=?"},link:function(scope,element){function uncheckAll(){for(var i=0;i<viewable.length;i++)scope.checkB[i]&&scope.checkB[i]._checked===!0&&(scope.checkB[i]._checked=!1);scope.checkB[-1]&&(scope.checkB[-1]._checked=!1)}function watch(){ngModelWatch=scope.$watch("ngModel",function(newArray,oldArray){newArray!==oldArray&&(resort(),scope.buildTable())},!0)}function handleHeaders(){angular.forEach(scope.headers,function(value){angular.isDefined(value.alias)&&null!==value.alias||(value.alias=value.field),angular.isDefined(value.visible)&&null!==value.visible||(value.visible=!0)})}function setHeader(table,keys){var header=table.createTHead(),row=header.insertRow(0);scope.selectedMax=keys.length-1;var thCheck=document.createElement("th");thCheck.innerHTML=createCheckbox(-1,i,"hulp"),row.appendChild(thCheck);for(var k=0;k<keys.length;k++)if(keys[k]&&keys[k].checked&&keys[k].visible){var val=keys[k].alias||keys[k].field,th=document.createElement("th");th.innerHTML=val,row.appendChild(th),$(th).bind("click",sorte(k)),keys[k]===scope.sorting.obj&&(1===scope.sorting.direction?$(th).addClass("sort-asc"):-1===scope.sorting.direction&&$(th).addClass("sort-desc"))}}function resort(){if(scope.sorting&&scope.sorting.obj){var sortKey=scope.sorting.obj.field;sorter(sortKey,scope.sorting.direction)}}function sorte(i){return function(){scope.sorting.obj;var key=scope.headers[i].field;scope.sorting.field===key?scope.sorting.direction=-1*scope.sorting.direction:(scope.sorting.field=key,scope.sorting.direction=1),sorter(key,scope.sorting.direction),scope.sorting.obj=scope.headers[i],scope.buildTable()}}function fullChecked(){for(var length=0,i=0;i<viewable.length;i++)scope.checkB[i]&&scope.checkB[i]._checked&&(length+=1);scope.checkB[-1]||(scope.checkB[-1]={}),0!==length?scope.selectedCheck=!0:scope.selectedCheck=!1,length===viewable.length?scope.checkB[-1]._checked=!0:scope.checkB[-1]._checked=!1}function createCheckbox(row,i,hulp){hulp||(hulp="");var checkbox='<div class="checkbox"><input type="checkbox" ng-change="checkChange('+row+')" ng-model="checkB['+row+']._checked" id="'+row+'" name="'+row+'" value="'+row+'"><label for="'+row+'"></label></div>';return checkbox}function setBody(table,content){for(var body=table.createTBody(),i=scope.headers.length-1;i>=0;i--)if(scope.headers[i]&&scope.headers[i].checked&&scope.headers[i].visible)for(var j=0;j<content.length;j++){var row;if(body.rows[j])row=body.rows[j];else{row=body.insertRow(j);var check=row.insertCell(0),index=j;check.innerHTML=createCheckbox(index,j)}var cell,val=content[j][scope.headers[i].field];cell=row.insertCell(scope.viewActions&&scope.viewActions.length>0?1:1),cell.innerHTML=val}}function sorter(sortVal,direction){ngModelWatch(),scope.ngModel.sort(function(obj1,obj2){var obj1Val=obj1[sortVal],obj2Val=obj2[sortVal];return _.isString(obj1Val)||(obj1Val=obj1Val.toString()),_.isString(obj2Val)||(obj2Val=obj2Val.toString()),direction?direction*obj1Val.localeCompare(obj2Val):obj1Val.localeCompare(obj2Val)}),watch()}function buildPagination(){scope.showNums=[];var num=scope.pageSelected,numPages=scope.pages;6>numPages?scope.showNums=_.range(2,numPages):4>num?(scope.showNums=_.range(2,4),scope.showNums.push(-1)):num>=numPages-2?scope.showNums=[-1].concat(_.range(numPages-2,numPages)):scope.showNums=[-1,num,-1],numPages>1&&scope.showNums.push(numPages)}if((!angular.isDefined(scope.ngModel)||null===scope.ngModel||!scope.ngModel instanceof Array)&&(scope.ngModel=[]),scope.headers&&!(scope.headers.length<1)){var pages,viewable,ngModelWatch,aantalToShow=1;if(watch(),scope.actions instanceof Array){scope.viewActions=[];for(var i=0;i<scope.actions.length;i++){var action=scope.actions[i];scope.viewActions.push({name:action.name,callback:function(){for(var checked=[],i=0;i<viewable.length;i++)scope.checkB[i]&&scope.checkB[i]._checked===!0&&checked.push(viewable[i]);action.callback(checked,uncheckAll)}})}}if("string"==typeof scope.itemsPerPage){var items=scope.itemsPerPage.split(",");scope.itemsPerPage=[];for(var j=0;j<items.length;j++)if("*"===items[j].slice(-1)){var num=_.parseInt(items[j].substr(0,items[j].length-1));scope.perPage={pages:num},scope.itemsPerPage.push(num)}else scope.itemsPerPage.push(_.parseInt(items[j]));scope.perPage||0===scope.itemsPerPage.length||(scope.perPage={pages:_.parseInt(items[0])})}else scope.perPage={pages:99999999999};scope.sorting={field:"",direction:1},!scope.headers instanceof Array&&(scope.headers=[]),handleHeaders(),scope.viewer=scope.headers,scope.checkChange=function(i){if(-1===i){var check=scope.checkB[-1]._checked;angular.forEach(scope.checkB,function(val){val._checked=check,scope.selectedCheck=check})}else scope.checkB[-1]&&(scope.checkB[-1]._checked=!1),fullChecked()},scope.actions=function(){},scope.hulpngModel=[],scope.checkB=[],scope.numSelected=0,scope.perPageClick=function(index){scope.numSelected=index,scope.pageSelected=1,scope.buildTable()},scope.pageSelected=1,scope.setPage=function(index){index>0&&(scope.pageSelected=index,uncheckAll(),scope.buildTable())},scope.setItems=function(){scope.buildTable(),fullChecked()},scope.createArray=function(num){for(var array=[],i=0;num>i;i++)array[i]={};return array},aantalToShow=scope.perPage.pages,scope.ngModel&&(pages=Math.ceil(scope.ngModel.length/aantalToShow)),scope.pages=_.range(1,pages),scope.buildTable=function(){var table=document.createElement("table");setHeader(table,scope.headers),aantalToShow=scope.perPage.pages,scope.ngModel&&(pages=Math.ceil(scope.ngModel.length/aantalToShow)),scope.pages=pages;var start=(scope.pageSelected-1)*aantalToShow,stop=scope.pageSelected*aantalToShow-1;if(viewable=_.slice(scope.ngModel,start,stop+1),scope.checkB=scope.createArray(viewable.length),0===viewable.length&&scope.pageSelected>1)return scope.pageSelected=scope.pageSelected-1,void scope.buildTable();0===scope.ngModel.length?scope.numFirst=0:scope.numFirst=start+1,stop>scope.ngModel.length?scope.numLast=scope.ngModel.length:scope.numLast=stop+1,buildPagination(),scope.itemLength=scope.ngModel.length,setBody(table,viewable),table=$(table),table.addClass("table-interactive"),fullChecked();var tableEl=element.find("table");tableEl.replaceWith(table),$compile(table)(scope)},scope.selected=-1,scope.omhoog=function(){scope.selected>0&&(scope.viewer.swap(scope.selected,scope.selected-1),scope.selected-=1),scope.buildTable()},scope.omlaag=function(){scope.selected>=0&&scope.selected<scope.viewer.length-1&&(scope.viewer.swap(scope.selected,scope.selected+1),scope.selected+=1),scope.buildTable()},scope.headerChange=function(){scope.buildTable()},Array.prototype.swap=function(a,b){var temp=this[a];this[a]=this[b],this[b]=temp},scope.buildTable(),scope.select=function(e,index){scope.selected=index,e.preventDefault(),e.stopPropagation()},scope.setFirst=function(){scope.setPage(1)},scope.setLast=function(){scope.setPage(pages)},scope.close=function(){$rootScope.$broadcast("popover-open",{group:"option-table",el:$("<div><div>")})},scope.setNext=function(){scope.pageSelected<pages&&(scope.pageSelected+=1,scope.setPage(scope.pageSelected))},scope.setPrev=function(){scope.pageSelected>1&&(scope.pageSelected-=1,scope.setPage(scope.pageSelected))}}}}}]).filter("myLimitTo",[function(){return function(obj,limit){var keys=Object.keys(obj);if(keys.length<1)return[];var ret={},count=0;return angular.forEach(keys,function(key){return count>=limit?!1:(ret[key]=obj[key],void count++)}),ret}}]).directive("tinkShiftSort",["$timeout",function(timeout){return{restirct:"A",link:function(scope,elem){timeout(function(){Sortable.create(elem.find("ul").get(0),{ghostClass:"draggable-placeholder",animation:200,handle:".draggable-elem",onStart:function(evt){scope.$apply(function(){scope.selected=evt.oldIndex})},onUpdate:function(evt){scope.$apply(function(){var old=scope.headers[evt.oldIndex];scope.headers[evt.oldIndex]=scope.headers[evt.newIndex],scope.headers[evt.newIndex]=old,scope.selected=evt.newIndex,scope.buildTable()})}})},200)}}}])}(),angular.module("tink.interactivetable").run(["$templateCache",function($templateCache){$templateCache.put("templates/tinkInteractiveTable.html",' <div class=bar> <div class=bar-section>  <ul class=bar-section-right> <li> <button data-ng-if="viewActions && selectedCheck" tink-popover tink-popover-group=option-table tink-popover-template=templates/tinkTableAction.html>Acties <i class="fa fa-caret-down"></i></button> </li> <li> <button data-ng-if="allowColumnReorder === true" tink-popover tink-popover-group=option-table tink-popover-template=templates/tinkTableShift.html>Kolommen <i class="fa fa-caret-down"></i></button> </li> </ul> </div> </div>  <table></table> <div data-ng-if=itemsPerPage class=table-sort-options data-ng-if="itemLength > 0"> <div class=table-sort-info> <strong>{{numFirst}} - {{numLast}}</strong> van {{itemLength}} <div class=select> <select data-ng-change=setItems() data-ng-model=perPage.pages> <option data-ng-repeat="items in itemsPerPage" data-ng-bind=items>{{items}}</option> </select> items per pagina </div> </div> <div class=table-sort-pagination data-ng-if="pages > 1"> <ul class=pagination> <li class=prev data-ng-class="{disabled:pageSelected===1}" data-ng-click=setPrev()><a href=""><span>Vorige</span></a></li> <li data-ng-class="{active:pageSelected===1}" data-ng-click=setFirst()><a href="">1</a></li> <li data-ng-repeat="pag in showNums track by $index" data-ng-class="{active:pag===pageSelected}" data-ng-click=setPage(pag)><a href="" data-ng-if="pag !== -1">{{pag}}</a> <span data-ng-show="pag === -1">...<span></span></span></li> <li class=next data-ng-click=setNext() data-ng-class="{disabled:pageSelected===pages}"><a href=""><span>Volgende</span></a></li> </ul> </div> </div>'),$templateCache.put("templates/tinkTableAction.html",'<ul class="popover-list-buttons ng-scope"> <li data-ng-repeat="action in viewActions"><a href="" data-ng-click=action.callback()>{{action.name}}</a></li> </ul>'),$templateCache.put("templates/tinkTableShift.html",'<div class=table-interactive-options tink-shift-sort>  <div class=table-interactive-sort> <button class=btn-borderless ng-disabled="selected<1" ng-click=omhoog()><i class="fa fa-arrow-up"> </i></button>\n<button class=btn-borderless ng-disabled="selected<0 || selected === selectedMax" ng-click=omlaag()><i class="fa fa-arrow-down"></i></button> </div>  <ul ng-model=viewer class=table-interactive-cols> <li ng-repeat="header in viewer | filter:{ visible: true }"> <div class="checkbox is-selectable is-draggable" ng-class="{selected:selected===$index}"> <input type=checkbox ng-model=header.checked ng-change=headerChange() id={{header.alias}} name={{header.alias}} value={{header.alias}} checked> <label for={{header.alias}}><span class=draggable-elem ng-class="{selected:selected===$index}" ng-click=select($event,$index)>{{header.alias}}</span></label> </div> </li> </ul> <div class=table-interactive-sort>  <button class=btn-xs ng-click=close()>Sluiten</button> </div> </div>')}]);
//# sourceMappingURL=tink-interactive-table-angular.min.map